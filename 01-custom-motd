#!/bin/bash

export TERM=xterm-256color

#Get username
PPID1=`cat /proc/$PPID/status | grep PPid | awk '{ print $2 }'`
PPID2=`cat /proc/$PPID1/status | grep PPid | awk '{ print $2 }'`
username=`ps -x | grep $PPID2 | awk '{ print $6 }' |  sed "s/[[:digit:].-]//g"`

# Get current date and time
now=$(date +'%A, %B %d, %Y - %H:%M:%S %Z')

# Get disk usage information
df_output=$(df -h /)
total_space=$(echo "$df_output" | awk 'NR==2{print $2}')
remaining_space=$(echo "$df_output" | awk 'NR==2{print $4}')

# Calculate available space percentage
space_pct=$(echo "$df_output" | awk 'NR==2{print $5}' | cut -d "%" -f1)

# Calculate number of full and empty characters for bar
full_chars=$((($space_pct * 50 + 50/2) / 100))
empty_chars=$((50 - full_chars))

# Generate bar graph
bar_graph=""
for (( i=0; i<full_chars; i++ )); do
  bar_graph+="■"  # Assuming "■" represents a full character
done
for (( i=0; i<empty_chars; i++ )); do
  bar_graph+="-"  # Adding a space for an empty character
done

# Get internal and external IP addresses
internal_ip=$(hostname -I | awk '{print $1}')
external_ip=$(curl -s https://icanhazip.com)  # Replace with preferred external IP service

#Print MOTD
exec figlet -f smslant "Welcome ${username^} !" | /usr/games/lolcat -f
echo "$(tput setaf 2) 
`date +"%A, %e %B %Y, %r"` 
`uname -srmo`"

echo ""
echo ""

echo "$(tput setaf 6)Last login information:"
echo "---------------------------------------------------------------------------"
printf "%-15s | %-15s | %-20s | %-20s\n" "Username" "Terminal" "Date" "IP Address"
echo "---------------------------------------------------------------------------"
last | head -n 1 | awk '{printf "%-15s | %-15s | %-20s | %-20s\n", $1, $2, $4" "$5" "$6, $3}'
echo "---------------------------------------------------------------------------"

echo "
$(tput setaf 1)Total Disk Space: $total_space
Remaining Disk Space: $remaining_space/$total_space ($space_pct%)
Disk Usage: [$bar_graph]
Internal IP: $internal_ip
External IP: $external_ip
"